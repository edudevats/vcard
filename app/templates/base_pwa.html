<!DOCTYPE html>
<html class="" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>{% block title %}Digital Business Card PWA{% endblock %}</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Crea y gestiona tus tarjetas de presentación digitales de forma profesional">
    <meta name="theme-color" content="#1193d4">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="VCard Digital">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <!-- Dashboard Favicons -->
    <link rel="icon" href="/favicon.ico?v=5">
    <link rel="shortcut icon" href="/favicon.ico?v=5">
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#1193d4',
              'background-light': '#f6f7f8',
              'background-dark': '#101c22',
            },
            fontFamily: {
              display: ['Manrope'],
            },
            borderRadius: {
              DEFAULT: '0.25rem',
              lg: '0.5rem',
              xl: '0.75rem',
              full: '9999px',
            },
          },
        },
      };
    </script>

    <style>
      .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
      }

      body {
        min-height: max(884px, 100dvh);
      }

      /* Custom animations */
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Bottom navigation active state */
      .nav-active {
        background: rgba(17, 147, 212, 0.1);
        color: #1193d4;
      }

      .nav-active.dark {
        background: rgba(17, 147, 212, 0.2);
      }

      /* Material symbols fill variations */
      .fill-1 {
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
      }
    </style>

    {% block styles %}{% endblock %}
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-white">
    <div class="flex h-screen flex-col">
        <!-- Header (conditional) -->
        {% if show_header %}
        <header class="sticky top-0 z-10 flex items-center justify-between bg-background-light/80 p-4 backdrop-blur-sm dark:bg-background-dark/80">
            <div class="flex items-center gap-3">
                {% if current_user.is_authenticated %}
                <div class="h-10 w-10 shrink-0">
                    <img alt="User Avatar" class="h-full w-full rounded-full object-cover"
                         src="/static/logo/logoNB.png">
                </div>
                <p class="font-bold">{{ current_user.email.split('@')[0] }}</p>
                {% else %}
                <div class="h-10 w-10 shrink-0">
                    <img alt="Logo" class="h-full w-full object-contain" src="/static/logo/logoNB.png">
                </div>
                <p class="font-bold">VCard Digital</p>
                {% endif %}
            </div>
            <button id="menu-btn" class="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary dark:bg-primary/20 mr-2">
                <span class="material-symbols-outlined"> menu </span>
            </button>
            <button id="notifications-btn" class="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary dark:bg-primary/20">
                <span class="material-symbols-outlined"> notifications </span>
            </button>
        </header>
        {% endif %}

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            {% block content %}{% endblock %}
        </main>

        <!-- Bottom Navigation (conditional) -->
        {% if show_bottom_nav %}
        <nav class="sticky bottom-0 z-20 border-t border-gray-200 bg-background-light dark:border-gray-800 dark:bg-background-dark">
            <div class="mx-auto grid max-w-md grid-cols-5 gap-2 px-4 pb-3 pt-2">
                <a class="nav-link flex flex-col items-center gap-1 rounded-lg py-1 {% if active_tab == 'home' %}nav-active{% else %}text-gray-500 dark:text-gray-400{% endif %}" href="{{ url_for('dashboard.index') }}">
                    <span class="material-symbols-outlined {% if active_tab == 'home' %}fill-1{% endif %}"> home </span>
                    <span class="text-xs {% if active_tab == 'home' %}font-bold{% else %}font-medium{% endif %}">Home</span>
                </a>
                <a class="nav-link flex flex-col items-center gap-1 rounded-lg py-1 {% if active_tab == 'cards' %}nav-active{% else %}text-gray-500 dark:text-gray-400{% endif %}" href="{{ url_for('dashboard.cards_list') }}">
                    <span class="material-symbols-outlined {% if active_tab == 'cards' %}fill-1{% endif %}"> credit_card </span>
                    <span class="text-xs {% if active_tab == 'cards' %}font-bold{% else %}font-medium{% endif %}">Tarjetas</span>
                </a>
                <a class="nav-link flex flex-col items-center gap-1 rounded-lg py-1 {% if active_tab == 'create' %}nav-active{% else %}text-gray-500 dark:text-gray-400{% endif %}" href="{{ url_for('dashboard.new_card') }}">
                    <span class="material-symbols-outlined {% if active_tab == 'create' %}fill-1{% endif %}"> add_box </span>
                    <span class="text-xs {% if active_tab == 'create' %}font-bold{% else %}font-medium{% endif %}">Crear</span>
                </a>
                <a class="nav-link flex flex-col items-center gap-1 rounded-lg py-1 {% if active_tab == 'analytics' %}nav-active{% else %}text-gray-500 dark:text-gray-400{% endif %}" href="{{ url_for('dashboard.analytics') }}">
                    <span class="material-symbols-outlined {% if active_tab == 'analytics' %}fill-1{% endif %}"> bar_chart </span>
                    <span class="text-xs {% if active_tab == 'analytics' %}font-bold{% else %}font-medium{% endif %}">Stats</span>
                </a>
                <a class="nav-link flex flex-col items-center gap-1 rounded-lg py-1 {% if active_tab == 'profile' %}nav-active{% else %}text-gray-500 dark:text-gray-400{% endif %}" href="{{ url_for('dashboard.profile') }}">
                    <span class="material-symbols-outlined {% if active_tab == 'profile' %}fill-1{% endif %}"> person </span>
                    <span class="text-xs {% if active_tab == 'profile' %}font-bold{% else %}font-medium{% endif %}">Perfil</span>
                </a>
            </div>
        </nav>
        {% endif %}

        <!-- Slide-out Menu (for secondary actions) -->
        <div id="slide-menu" class="fixed left-0 top-0 z-30 h-full w-64 transform bg-background-light shadow-lg transition-transform duration-300 ease-in-out dark:bg-background-dark lg:w-80" style="transform: translateX(-100%);">
            <div class="flex h-full flex-col">
                <div class="flex items-center justify-between p-4">
                    <h2 class="text-lg font-bold">Menú</h2>
                    <button id="close-menu" class="flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4">
                    {% block slide_menu_content %}{% endblock %}
                </div>
            </div>
        </div>

        <!-- Overlay for slide menu -->
        <div id="menu-overlay" class="fixed inset-0 z-20 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300"></div>
    </div>

    <!-- PWA Scripts -->
    <script src="/static/js/pwa.js"></script>

    <!-- Custom PWA JavaScript -->
    <script>
        // Dark mode toggle
        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            html.classList.toggle('dark', !isDark);
            localStorage.setItem('darkMode', !isDark ? 'true' : 'false');
        }

        // Initialize dark mode
        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode === 'true' || (!savedDarkMode && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // Slide menu functionality
        function openSlideMenu() {
            document.getElementById('slide-menu').style.transform = 'translateX(0)';
            document.getElementById('menu-overlay').classList.remove('opacity-0', 'pointer-events-none');
            document.getElementById('menu-overlay').classList.add('opacity-100');
            document.body.style.overflow = 'hidden';
        }

        function closeSlideMenu() {
            document.getElementById('slide-menu').style.transform = 'translateX(-100%)';
            document.getElementById('menu-overlay').classList.remove('opacity-100');
            document.getElementById('menu-overlay').classList.add('opacity-0', 'pointer-events-none');
            document.body.style.overflow = '';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Menu button functionality
            const menuBtn = document.getElementById('menu-btn');
            if (menuBtn) {
                menuBtn.addEventListener('click', openSlideMenu);
            }

            // Close menu when clicking overlay
            document.getElementById('menu-overlay').addEventListener('click', closeSlideMenu);

            // Close menu with escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSlideMenu();
                }
            });

            // Add fade-in animation to main content
            const mainContent = document.querySelector('main');
            if (mainContent) {
                mainContent.classList.add('fade-in');
            }
        });

        // Touch gestures for mobile
        let startX = 0;
        let startY = 0;

        document.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', function(e) {
            if (!startX || !startY) return;

            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;

            // Swipe from left edge to open menu
            if (Math.abs(diffX) > Math.abs(diffY) && diffX < -50 && startX < 50) {
                openSlideMenu();
            }
            // Swipe right to close menu
            else if (Math.abs(diffX) > Math.abs(diffY) && diffX > 50) {
                closeSlideMenu();
            }

            startX = 0;
            startY = 0;
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>