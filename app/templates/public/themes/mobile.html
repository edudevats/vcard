<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ card.title or card.name }} - Tarjeta Digital</title>
    
    <!-- Dynamic Favicon -->
    {% if card.has_avatar() %}
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='uploads/' + card.get_avatar_path()) }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='uploads/' + card.get_avatar_path()) }}">
    {% else %}
    <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/static/icons/favicon.ico">
    {% endif %}
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{{ card.bio[:160] if card.bio else 'Tarjeta de presentación digital de ' + card.name }}">
    <meta name="keywords" content="tarjeta digital, {{ card.name }}, {{ card.company or '' }}, contacto">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ card.title or card.name }}">
    <meta property="og:description" content="{{ card.bio[:160] if card.bio else 'Tarjeta de presentación digital' }}">
    <meta property="og:type" content="profile">
    {% if featured_image %}
    <meta property="og:image" content="{{ url_for('static', filename='uploads/' + featured_image.image_path) }}">
    {% elif card.has_avatar() %}
    <meta property="og:image" content="{{ card.get_avatar_url_with_cache_busting() or url_for('static', filename='uploads/' + card.get_avatar_path()) }}">
    {% endif %}

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <style type="text/tailwindcss">
        :root {
            --primary-color: {{ card.theme.primary_color or '#1173d4' }};
            --secondary-color: {{ card.theme.secondary_color or '#d4e7f9' }};
            --background-color: #f8faff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --accent-color: {{ card.theme.accent_color or '#88bde8' }};
        }
        body {
            font-family: '{{ card.theme.font_family or 'Inter' }}', sans-serif;
            background-color: var(--background-color);
        }
    </style>
    
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
        .avatar-{{ card.theme.avatar_shape or 'circle' }} {
            {% if card.theme.avatar_shape == 'square' %}
                border-radius: 0;
            {% elif card.theme.avatar_shape == 'rounded' %}
                border-radius: 1rem;
            {% elif card.theme.avatar_shape == 'rectangle' %}
                border-radius: 0.5rem;
                width: 8rem;
                height: 6rem;
            {% else %}
                border-radius: 50%;
            {% endif %}
        }
    </style>
</head>
<body class="bg-[var(--background-color)] text-[var(--text-primary)]">
    <div class="relative flex size-full min-h-screen flex-col justify-between">
        <div class="flex-grow">
            <!-- Header -->
            <header class="bg-white p-4 shadow-sm">
                <div class="flex items-center justify-between">
                    <button class="p-2 rounded-full hover:bg-gray-100" onclick="window.history.back();">
                        <svg fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
                            <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-center flex-1">Tarjeta de Presentación</h1>
                    <div class="w-10"></div>
                </div>
            </header>
            
            <!-- Main Content -->
            <main class="p-6">
                <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-200/50">
                    <!-- Profile Section -->
                    <div class="flex flex-col items-center text-center">
                        <div class="mb-4">
                            {% if card.has_avatar() %}
                            <img alt="{{ card.name }}" 
                                 class="w-32 h-32 avatar-{{ card.theme.avatar_shape or 'circle' }} object-cover border-4" 
                                 style="border-color: {{ card.theme.avatar_border_color or '#ffffff' }};"
                                 src="{{ card.get_avatar_url_with_cache_busting() or url_for('static', filename='uploads/' + card.get_avatar_path()) }}">
                            {% else %}
                            <div class="w-32 h-32 avatar-{{ card.theme.avatar_shape or 'circle' }} bg-[var(--secondary-color)] border-4 flex items-center justify-center" 
                                 style="border-color: {{ card.theme.avatar_border_color or '#ffffff' }};">
                                <span class="text-3xl font-bold text-[var(--primary-color)]">{{ card.name[0].upper() }}</span>
                            </div>
                            {% endif %}
                        </div>
                        <h2 class="text-2xl font-bold text-[var(--text-primary)]">{{ card.name }}</h2>
                        {% if card.job_title %}
                        <p class="text-lg text-[var(--text-secondary)]">{{ card.job_title }}</p>
                        {% endif %}
                        {% if card.company %}
                        <p class="text-md text-[var(--text-secondary)]">{{ card.company }}</p>
                        {% endif %}
                        {% if card.bio %}
                        <p class="text-sm text-[var(--text-secondary)] mt-2">{{ card.bio }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Contact Information -->
                    {% if card.phone or card.email_public or card.website %}
                    <div class="mt-8 space-y-4">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] border-b pb-2 mb-4">Información de Contacto</h3>
                        
                        {% if card.phone %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M222.37,158.46l-47.11-21.11-.13-.06a16,16,0,0,0-15.17,1.4,8.12,8.12,0,0,0-.75.56L134.87,160c-15.42-7.49-31.34-23.29-38.83-38.51l20.78-24.71c.2-.25.39-.5.57-.77a16,16,0,0,0,1.32-15.06l0-.12L97.54,33.64a16,16,0,0,0-16.62-9.52A56.26,56.26,0,0,0,32,80c0,79.4,64.6,144,144,144a56.26,56.26,0,0,0,55.88-48.92A16,16,0,0,0,222.37,158.46ZM176,208A128.14,128.14,0,0,1,48,80,40.2,40.2,0,0,1,82.87,40a.61.61,0,0,0,0,.12l21,47L83.2,111.86a6.13,6.13,0,0,0-.57.77,16,16,0,0,0-1,15.7c9.06,18.53,27.73,37.06,46.46,46.11a16,16,0,0,0,15.75-1.14,8.44,8.44,0,0,0,.74-.56L168.89,152l47,21.05h0s.08,0,.11,0A40.21,40.21,0,0,1,176,208Z"></path>
                                </svg>
                            </div>
                            <a href="tel:{{ card.phone }}" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">{{ card.phone }}</a>
                        </div>
                        {% endif %}
                        
                        {% if card.email_public %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M224,48H32a8,8,0,0,0-8,8V192a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A8,8,0,0,0,224,48Zm-96,85.15L52.57,64H203.43ZM98.71,128,40,181.81V74.19Zm11.84,10.85,12,11.05a8,8,0,0,0,10.82,0l12-11.05,58,53.15H52.57ZM157.29,128,216,74.18V181.82Z"></path>
                                </svg>
                            </div>
                            <a href="mailto:{{ card.email_public }}" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">{{ card.email_public }}</a>
                        </div>
                        {% endif %}
                        
                        {% if card.website %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM101.63,168h52.74C149,186.34,140,202.87,128,215.89,116,202.87,107,186.34,101.63,168ZM98,152a145.72,145.72,0,0,1,0-48h60a145.72,145.72,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.79a161.79,161.79,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154.37,88H101.63C107,69.66,116,53.13,128,40.11,140,53.13,149,69.66,154.37,88Zm19.84,16h38.46a88.15,88.15,0,0,1,0,48H174.21a161.79,161.79,0,0,0,0-48Zm32.16-16H170.94a142.39,142.39,0,0,0-20.26-45A88.37,88.37,0,0,1,206.37,88ZM105.32,43A142.39,142.39,0,0,0,85.06,88H49.63A88.37,88.37,0,0,1,105.32,43ZM49.63,168H85.06a142.39,142.39,0,0,0,20.26,45A88.37,88.37,0,0,1,49.63,168Zm101.05,45a142.39,142.39,0,0,0,20.26-45h35.43A88.37,88.37,0,0,1,150.68,213Z"></path>
                                </svg>
                            </div>
                            <a href="{{ 'https://' + card.website if not card.website.startswith('http') else card.website }}" target="_blank" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">{{ card.website }}</a>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Social Networks -->
                    {% if card.instagram or card.facebook or card.linkedin or card.twitter %}
                    <div class="mt-8 space-y-4">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] border-b pb-2 mb-4">Redes Sociales</h3>
                        
                        {% if card.linkedin %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M216,24H40A16,16,0,0,0,24,40V216a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V40A16,16,0,0,0,216,24Zm0,192H40V40H216V216ZM96,112v64a8,8,0,0,1-16,0V112a8,8,0,0,1,16,0Zm88,28v36a8,8,0,0,1-16,0V140a20,20,0,0,0-40,0v36a8,8,0,0,1-16,0V112a8,8,0,0,1,15.79-1.78A36,36,0,0,1,184,140ZM100,84A12,12,0,1,1,88,72,12,12,0,0,1,100,84Z"></path>
                                </svg>
                            </div>
                            <a href="https://linkedin.com/in/{{ card.linkedin }}" target="_blank" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">LinkedIn</a>
                        </div>
                        {% endif %}
                        
                        {% if card.twitter %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M247.39,68.94A8,8,0,0,0,240,64H209.57A48.66,48.66,0,0,0,168.1,40a46.91,46.91,0,0,0-33.75,13.7A47.9,47.9,0,0,0,120,88v6.09C79.74,83.47,46.81,50.72,46.46,50.37a8,8,0,0,0-13.65,4.92c-4.31,47.79,9.57,79.77,22,98.18a110.93,110.93,0,0,0,21.88,24.2c-15.23,17.53-39.21,26.74-39.47,26.84a8,8,0,0,0-3.85,11.93c.75,1.12,3.75,5.05,11.08,8.72C53.51,229.7,65.48,232,80,232c70.67,0,129.72-54.42,135.75-124.44l29.91-29.9A8,8,0,0,0,247.39,68.94Zm-45,29.41a8,8,0,0,0-2.32,5.14C196,166.58,143.28,216,80,216c-10.56,0-18-1.4-23.22-3.08,11.51-6.25,27.56-17,37.88-32.48A8,8,0,0,0,92,169.08c-.47-.27-43.91-26.34-44-96,16,13,45.25,33.17,78.67,38.79A8,8,0,0,0,136,104V88a32,32,0,0,1,9.6-22.92A30.94,30.94,0,0,1,167.9,56c12.66.16,24.49,7.88,29.44,19.21A8,8,0,0,0,204.67,80h16Z"></path>
                                </svg>
                            </div>
                            <a href="https://twitter.com/{{ card.twitter }}" target="_blank" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">Twitter</a>
                        </div>
                        {% endif %}
                        
                        {% if card.instagram %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160ZM176,24H80A56.06,56.06,0,0,0,24,80v96a56.06,56.06,0,0,0,56,56h96a56.06,56.06,0,0,0,56-56V80A56.06,56.06,0,0,0,176,24Zm40,152a40,40,0,0,1-40,40H80a40,40,0,0,1-40-40V80A40,40,0,0,1,80,40h96a40,40,0,0,1,40,40ZM192,76a12,12,0,1,1-12-12A12,12,0,0,1,192,76Z"></path>
                                </svg>
                            </div>
                            <a href="https://instagram.com/{{ card.instagram }}" target="_blank" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">Instagram</a>
                        </div>
                        {% endif %}
                        
                        {% if card.facebook %}
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center rounded-xl bg-[var(--secondary-color)] shrink-0 size-12">
                                <svg class="text-[var(--primary-color)]" fill="currentColor" height="28px" viewBox="0 0 256 256" width="28px" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M256,128C256,57.31,198.69,0,128,0S0,57.31,0,128c0,63.72,46.77,116.61,108,126.16V165H75.5V128H108V99.75c0-32.08,19.11-49.75,48.35-49.75,14.02,0,28.65,2.5,28.65,2.5V84H167.8c-15.88,0-20.8,9.86-20.8,19.98V128h35.4l-5.66,37H147v89.16C209.23,244.61,256,191.72,256,128Z"></path>
                                </svg>
                            </div>
                            <a href="https://facebook.com/{{ card.facebook }}" target="_blank" class="text-base text-[var(--text-secondary)] hover:text-[var(--primary-color)]">Facebook</a>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Services -->
                    {% if services %}
                    <div class="mt-8 space-y-4">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] border-b pb-2 mb-4">Servicios</h3>
                        <div class="space-y-3">
                            {% for service in services %}
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <h4 class="font-medium text-[var(--text-primary)]">{{ service.name }}</h4>
                                {% if service.description %}
                                <p class="text-sm text-[var(--text-secondary)] mt-1">{{ service.description }}</p>
                                {% endif %}
                                {% if service.price %}
                                <p class="text-sm font-semibold text-[var(--primary-color)] mt-1">${{ service.price }}</p>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </main>
        </div>
        
        <!-- Footer with Share Button -->
        <footer class="bg-white p-4 sticky bottom-0 border-t">
            <button onclick="shareCard()" class="w-full bg-[var(--primary-color)] text-white text-lg font-semibold leading-normal tracking-wide py-4 px-5 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] focus:ring-opacity-50 transition duration-200 ease-in-out">
                Compartir
            </button>
        </footer>
    </div>

    <script>
        function shareCard() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ card.name }} - Tarjeta Digital',
                    text: '{{ card.bio[:100] if card.bio else "Conoce mi información de contacto" }}',
                    url: window.location.href
                });
            } else {
                // Fallback para navegadores que no soportan Web Share API
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    alert('Enlace copiado al portapapeles');
                });
            }
        }
        
        // Track visit
        fetch('{{ url_for("public.track_view", slug=card.slug) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
    </script>
</body>
</html>