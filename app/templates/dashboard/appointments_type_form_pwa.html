{% extends "base_pwa.html" %}

{% set active_tab = 'appointments' %}
{% set show_header = true %}
{% set show_bottom_nav = true %}

{% block title %}{{ title }} - ATScard Digital{% endblock %}

{% block content %}
<div class="p-4 space-y-6">
    <!-- Header -->
    <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
            <span class="material-symbols-outlined text-primary align-middle mr-2">calendar_add_on</span>
            {{ title }}
        </h1>
    </div>

    <!-- Form -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
        <form method="POST" class="p-4 space-y-6">
            {{ form.hidden_tag() }}

            <!-- Name Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.name.label }}
                    <span class="text-red-500">*</span>
                </label>
                {{ form.name(class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white", placeholder="Ej: Consulta General") }}
                {% if form.name.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.name.errors[0] }}</p>
                {% endif %}
            </div>

            <!-- Prefix Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.prefix.label }}
                    <span class="text-red-500">*</span>
                </label>
                {{ form.prefix(class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white uppercase", placeholder="A, CON, INY", maxlength="5") }}
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">1-5 caracteres (ej: A, CON, INY)</p>
                {% if form.prefix.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.prefix.errors[0] }}</p>
                {% endif %}
            </div>

            <!-- Description Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.description.label }}
                </label>
                {{ form.description(class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white", rows=3, placeholder="Descripción opcional del tipo de cita") }}
            </div>

            <!-- Color Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.color.label }}
                </label>
                <div class="flex gap-3">
                    {{ form.color(class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white", type="color") }}
                    <div class="w-12 h-10 border border-gray-300 dark:border-gray-600 rounded-lg"
                         style="background-color: {{ form.color.data or '#6366f1' }};"></div>
                </div>
            </div>

            <!-- Duration Field -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    {{ form.estimated_duration.label }}
                </label>
                {{ form.estimated_duration(class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white", type="number", min="1", placeholder="30") }}
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Duración estimada en minutos</p>
            </div>

            <!-- Active Checkbox -->
            <div class="flex items-center">
                {{ form.is_active(class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600") }}
                <label class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ form.is_active.label }}
                </label>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-4">
                {{ form.submit(class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-semibold transition-colors") }}
                <a href="{{ url_for('dashboard.appointments_settings') }}"
                   class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold transition-colors text-center">
                    Cancelar
                </a>
            </div>
        </form>
    </div>

    <!-- Color Preview -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Vista Previa</h3>
        <div class="space-y-3">
            <div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm"
                     id="preview-color" style="background-color: {{ form.color.data or '#6366f1' }};">
                    <span id="preview-prefix">{{ form.prefix.data or 'A' }}</span>
                </div>
                <div>
                    <div class="font-semibold text-gray-900 dark:text-white" id="preview-name">
                        {{ form.name.data or 'Tipo de Cita' }}
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        Duración: <span id="preview-duration">{{ form.estimated_duration.data or '30' }}</span> min
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Update preview in real-time
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.querySelector('input[name="name"]');
    const prefixInput = document.querySelector('input[name="prefix"]');
    const colorInput = document.querySelector('input[name="color"]');
    const durationInput = document.querySelector('input[name="estimated_duration"]');

    const previewName = document.getElementById('preview-name');
    const previewPrefix = document.getElementById('preview-prefix');
    const previewColor = document.getElementById('preview-color');
    const previewDuration = document.getElementById('preview-duration');

    function updatePreview() {
        if (nameInput && previewName) {
            previewName.textContent = nameInput.value || 'Tipo de Cita';
        }
        if (prefixInput && previewPrefix) {
            previewPrefix.textContent = (prefixInput.value || 'A').toUpperCase();
        }
        if (colorInput && previewColor) {
            previewColor.style.backgroundColor = colorInput.value;
        }
        if (durationInput && previewDuration) {
            previewDuration.textContent = durationInput.value || '30';
        }
    }

    // Add event listeners
    if (nameInput) nameInput.addEventListener('input', updatePreview);
    if (prefixInput) prefixInput.addEventListener('input', updatePreview);
    if (colorInput) colorInput.addEventListener('input', updatePreview);
    if (durationInput) durationInput.addEventListener('input', updatePreview);

    // Auto-uppercase prefix
    if (prefixInput) {
        prefixInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    }
});
</script>
{% endblock %}